<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Zoe: Offer-Safety Enforcement | Alpha</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/documentation/favicon-full.ico">
    <style type="text/css">
    .two-col-table td {
        width: 50%;
    }
    .two-col-table table {
        table-layout: fixed;
    }</style>
    <script src="https://www.googletagmanager.com/gtag/js?id=UA-118217811-1"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-118217811-1'); </script>
    <script>
    const logoUrlChanger = setInterval(function() {
    //Anchor above the logo image
    const homeEls = document.getElementsByClassName("home-link");
    if(homeEls.length > 0) {
      const homeEl = homeEls[0];
      homeEl.setAttribute("href", "https://agoric.com");
      homeEl.setAttribute("onclick", "return false;");
      clearInterval(logoUrlChanger);
    }

    //Actual logo image
    const logoEls = document.getElementsByClassName("logo")
    if(logoEls.length > 0) {
      const logoEl = logoEls[0]
      logoEl.setAttribute("onclick", "document.location='https://agoric.com';return false;");
      clearInterval(logoUrlChanger);
    }
   }, 1000) </script>
    <meta name="description" content="Build, deploy and operate dApps and DeFi markets.">
    
    <link rel="preload" href="/documentation/assets/css/0.styles.3032228c.css" as="style"><link rel="preload" href="/documentation/assets/js/app.e9d39649.js" as="script"><link rel="preload" href="/documentation/assets/js/2.055035d6.js" as="script"><link rel="preload" href="/documentation/assets/js/68.b16ef159.js" as="script"><link rel="preload" href="/documentation/assets/js/20.87ef6363.js" as="script"><link rel="prefetch" href="/documentation/assets/js/10.585b2158.js"><link rel="prefetch" href="/documentation/assets/js/11.9a98c34f.js"><link rel="prefetch" href="/documentation/assets/js/12.5c179c24.js"><link rel="prefetch" href="/documentation/assets/js/13.5d1f0876.js"><link rel="prefetch" href="/documentation/assets/js/14.fa0ecac6.js"><link rel="prefetch" href="/documentation/assets/js/15.f2b84c5b.js"><link rel="prefetch" href="/documentation/assets/js/16.6a6558c6.js"><link rel="prefetch" href="/documentation/assets/js/17.17052e2b.js"><link rel="prefetch" href="/documentation/assets/js/18.e5d573f0.js"><link rel="prefetch" href="/documentation/assets/js/19.f6159705.js"><link rel="prefetch" href="/documentation/assets/js/21.2bf0bcc8.js"><link rel="prefetch" href="/documentation/assets/js/22.3c41c5fe.js"><link rel="prefetch" href="/documentation/assets/js/23.3ce7e6cd.js"><link rel="prefetch" href="/documentation/assets/js/24.0c1bb113.js"><link rel="prefetch" href="/documentation/assets/js/25.4a088968.js"><link rel="prefetch" href="/documentation/assets/js/26.b2120513.js"><link rel="prefetch" href="/documentation/assets/js/27.c02f4aff.js"><link rel="prefetch" href="/documentation/assets/js/28.c50b740e.js"><link rel="prefetch" href="/documentation/assets/js/29.9215e21e.js"><link rel="prefetch" href="/documentation/assets/js/3.5029543d.js"><link rel="prefetch" href="/documentation/assets/js/30.aa842318.js"><link rel="prefetch" href="/documentation/assets/js/31.14590e40.js"><link rel="prefetch" href="/documentation/assets/js/32.e34543b0.js"><link rel="prefetch" href="/documentation/assets/js/33.08dc5e79.js"><link rel="prefetch" href="/documentation/assets/js/34.be2a1606.js"><link rel="prefetch" href="/documentation/assets/js/35.4339ff49.js"><link rel="prefetch" href="/documentation/assets/js/36.f50aba9e.js"><link rel="prefetch" href="/documentation/assets/js/37.2d97d21b.js"><link rel="prefetch" href="/documentation/assets/js/38.1064fcbf.js"><link rel="prefetch" href="/documentation/assets/js/39.7eab9bf3.js"><link rel="prefetch" href="/documentation/assets/js/4.45e5a0cd.js"><link rel="prefetch" href="/documentation/assets/js/40.2e9758c8.js"><link rel="prefetch" href="/documentation/assets/js/41.fb0e921d.js"><link rel="prefetch" href="/documentation/assets/js/42.5bfa7121.js"><link rel="prefetch" href="/documentation/assets/js/43.6b0e5f2c.js"><link rel="prefetch" href="/documentation/assets/js/44.737659ce.js"><link rel="prefetch" href="/documentation/assets/js/45.fef430e8.js"><link rel="prefetch" href="/documentation/assets/js/46.2bd64db0.js"><link rel="prefetch" href="/documentation/assets/js/47.5ae1df34.js"><link rel="prefetch" href="/documentation/assets/js/48.bbcba416.js"><link rel="prefetch" href="/documentation/assets/js/49.ab14f817.js"><link rel="prefetch" href="/documentation/assets/js/5.ad898805.js"><link rel="prefetch" href="/documentation/assets/js/50.8489dcf8.js"><link rel="prefetch" href="/documentation/assets/js/51.84a46060.js"><link rel="prefetch" href="/documentation/assets/js/52.ccdc748b.js"><link rel="prefetch" href="/documentation/assets/js/53.2630e864.js"><link rel="prefetch" href="/documentation/assets/js/54.7c35a2f1.js"><link rel="prefetch" href="/documentation/assets/js/55.5dc8b5c3.js"><link rel="prefetch" href="/documentation/assets/js/56.745b027d.js"><link rel="prefetch" href="/documentation/assets/js/57.de5ade0c.js"><link rel="prefetch" href="/documentation/assets/js/58.183f3fdf.js"><link rel="prefetch" href="/documentation/assets/js/59.3fc1a30d.js"><link rel="prefetch" href="/documentation/assets/js/6.6a786cd3.js"><link rel="prefetch" href="/documentation/assets/js/60.494b175d.js"><link rel="prefetch" href="/documentation/assets/js/61.94d8d5ff.js"><link rel="prefetch" href="/documentation/assets/js/62.da3dd3f8.js"><link rel="prefetch" href="/documentation/assets/js/63.ea00a8ce.js"><link rel="prefetch" href="/documentation/assets/js/64.7f2edaf9.js"><link rel="prefetch" href="/documentation/assets/js/65.8d7fcace.js"><link rel="prefetch" href="/documentation/assets/js/66.b1bee48c.js"><link rel="prefetch" href="/documentation/assets/js/67.9238ee65.js"><link rel="prefetch" href="/documentation/assets/js/69.e5759c9c.js"><link rel="prefetch" href="/documentation/assets/js/7.8282d243.js"><link rel="prefetch" href="/documentation/assets/js/70.15df2113.js"><link rel="prefetch" href="/documentation/assets/js/71.ab1af6cb.js"><link rel="prefetch" href="/documentation/assets/js/72.85907030.js"><link rel="prefetch" href="/documentation/assets/js/73.a1a7a363.js"><link rel="prefetch" href="/documentation/assets/js/74.14bf8a3a.js"><link rel="prefetch" href="/documentation/assets/js/75.122cf302.js"><link rel="prefetch" href="/documentation/assets/js/76.cad1913f.js"><link rel="prefetch" href="/documentation/assets/js/77.6aaf5e0d.js"><link rel="prefetch" href="/documentation/assets/js/78.0cb7e765.js"><link rel="prefetch" href="/documentation/assets/js/79.e8a1b202.js"><link rel="prefetch" href="/documentation/assets/js/8.de2b40f3.js"><link rel="prefetch" href="/documentation/assets/js/80.c9f390a2.js"><link rel="prefetch" href="/documentation/assets/js/81.c5f99ea1.js"><link rel="prefetch" href="/documentation/assets/js/82.96575513.js"><link rel="prefetch" href="/documentation/assets/js/83.8acb0dc5.js"><link rel="prefetch" href="/documentation/assets/js/84.9a3f3930.js"><link rel="prefetch" href="/documentation/assets/js/85.3875c95e.js"><link rel="prefetch" href="/documentation/assets/js/86.72361b10.js"><link rel="prefetch" href="/documentation/assets/js/87.4f247b2a.js"><link rel="prefetch" href="/documentation/assets/js/88.7dcf1461.js"><link rel="prefetch" href="/documentation/assets/js/89.1d379d0c.js"><link rel="prefetch" href="/documentation/assets/js/9.b5b2cafd.js"><link rel="prefetch" href="/documentation/assets/js/90.5777bc7e.js"><link rel="prefetch" href="/documentation/assets/js/91.aa841d80.js">
    <link rel="stylesheet" href="/documentation/assets/css/0.styles.3032228c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/documentation/" class="home-link router-link-active"><img src="/documentation/logo.svg" alt="Alpha" class="logo"> <span class="site-name can-hide">Alpha</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started Menu" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/before-using-agoric.html" class="nav-link">
  Before Using Agoric
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/start-a-project.html" class="nav-link">
  Starting a Project
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/development-cycle.html" class="nav-link">
  Development Cycle
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/deploying.html" class="nav-link">
  Deploying Smart Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction.html" class="nav-link">
  ERTP Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Zoe Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/alpha.html" class="nav-link">
  Agoric Alpha
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/dapps/" class="nav-link">
  Agoric Dapps
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  ERTP
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Zoe
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/js-programming/" class="nav-link">
  Agoric JavaScript Programming
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/wallet/" class="nav-link">
  Wallet Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/repl/" class="nav-link">
  REPL
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/chainlink-integration.html" class="nav-link">
  Chainlink Integration
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/SwingSet/docs/networking.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dynamic IBC (dIBC)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Zoe Menu" class="dropdown-title"><span class="title">Zoe</span> <span class="arrow down"></span></button> <button type="button" aria-label="Zoe Menu" class="mobile-dropdown-title"><span class="title">Zoe</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/contracts/" class="nav-link">
  Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/zoe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ERTP Menu" class="dropdown-title"><span class="title">ERTP</span> <span class="arrow down"></span></button> <button type="button" aria-label="ERTP Menu" class="mobile-dropdown-title"><span class="title">ERTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Platform Menu" class="dropdown-title"><span class="title">Platform</span> <span class="arrow down"></span></button> <button type="button" aria-label="Platform Menu" class="mobile-dropdown-title"><span class="title">Platform</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/platform/" class="nav-link">
  Agoric Stack
</a></li></ul></div></div><div class="nav-item"><a href="/documentation/glossary/" class="nav-link">
  Glossary
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn More Menu" class="dropdown-title"><span class="title">Learn More</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn More Menu" class="mobile-dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://agoric.com/papers/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Papers
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/channel/UCpY91oQLh_Lp0mitdZ5bYWg/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow down"></span></button> <button type="button" aria-label="Getting Started Menu" class="mobile-dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/before-using-agoric.html" class="nav-link">
  Before Using Agoric
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/start-a-project.html" class="nav-link">
  Starting a Project
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/development-cycle.html" class="nav-link">
  Development Cycle
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/deploying.html" class="nav-link">
  Deploying Smart Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction.html" class="nav-link">
  ERTP Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Zoe Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/getting-started/alpha.html" class="nav-link">
  Agoric Alpha
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">
  Documentation
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/agoric-cli/" class="nav-link">
  Agoric CLI Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/dapps/" class="nav-link">
  Agoric Dapps
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  ERTP
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Zoe
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/js-programming/" class="nav-link">
  Agoric JavaScript Programming
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/wallet/" class="nav-link">
  Wallet Guide and API
</a></li><li class="dropdown-item"><!----> <a href="/documentation/repl/" class="nav-link">
  REPL
</a></li><li class="dropdown-item"><!----> <a href="/documentation/guides/chainlink-integration.html" class="nav-link">
  Chainlink Integration
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/SwingSet/docs/networking.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Dynamic IBC (dIBC)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Zoe Menu" class="dropdown-title"><span class="title">Zoe</span> <span class="arrow down"></span></button> <button type="button" aria-label="Zoe Menu" class="mobile-dropdown-title"><span class="title">Zoe</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/intro-zoe.html" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/contracts/" class="nav-link">
  Contracts
</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/zoe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ERTP Menu" class="dropdown-title"><span class="title">ERTP</span> <span class="arrow down"></span></button> <button type="button" aria-label="ERTP Menu" class="mobile-dropdown-title"><span class="title">ERTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/ertp-introduction/" class="nav-link">
  Introduction
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Platform Menu" class="dropdown-title"><span class="title">Platform</span> <span class="arrow down"></span></button> <button type="button" aria-label="Platform Menu" class="mobile-dropdown-title"><span class="title">Platform</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/platform/" class="nav-link">
  Agoric Stack
</a></li></ul></div></div><div class="nav-item"><a href="/documentation/glossary/" class="nav-link">
  Glossary
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn More Menu" class="dropdown-title"><span class="title">Learn More</span> <span class="arrow down"></span></button> <button type="button" aria-label="Learn More Menu" class="mobile-dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://agoric.com/papers/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Papers
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/channel/UCpY91oQLh_Lp0mitdZ5bYWg/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/documentation/getting-started/intro-zoe.html" class="sidebar-link">Zoe Introduction</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/zoe/guide/" aria-current="page" class="sidebar-heading clickable router-link-exact-active router-link-active open active"><span>Zoe Guide</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/documentation/zoe/guide/" aria-current="page" class="active sidebar-link">Zoe: Offer-Safety Enforcement</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/zoe/guide/#what-is-zoe" class="sidebar-link">What is Zoe?</a></li><li class="sidebar-sub-header"><a href="/documentation/zoe/guide/#sounds-like-magic-how-does-it-actually-work" class="sidebar-link">Sounds like magic. How does it actually work?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documentation/zoe/guide/#what-is-offer-safety" class="sidebar-link">What is &quot;offer safety&quot;?</a></li></ul></li><li class="sidebar-sub-header"><a href="/documentation/zoe/guide/#an-example-a-swap" class="sidebar-link">An example: A swap</a></li><li class="sidebar-sub-header"><a href="/documentation/zoe/guide/#how-to-write-smart-contracts" class="sidebar-link">How to write smart contracts</a></li><li class="sidebar-sub-header"><a href="/documentation/zoe/guide/#diving-deeper" class="sidebar-link">Diving Deeper</a></li></ul></li><li><a href="/documentation/zoe/guide/offer-safety.html" class="sidebar-link">Offer Safety</a></li><li><a href="/documentation/zoe/guide/proposal.html" class="sidebar-link">The Structure of Offers</a></li><li><a href="/documentation/zoe/guide/contract-requirements.html" class="sidebar-link">Contract Requirements</a></li><li><a href="/documentation/zoe/guide/price-authority.html" class="sidebar-link">Price Authority</a></li></ul></section></li><li><a href="/documentation/zoe/guide/contracts/" class="sidebar-link">Zoe Contracts</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/documentation/zoe/api/" class="sidebar-heading clickable"><span>Zoe API</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/documentation/zoe/roadmap/" class="sidebar-link">Zoe Roadmap</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="zoe-offer-safety-enforcement"><a href="#zoe-offer-safety-enforcement" class="header-anchor">#</a> Zoe: Offer-Safety Enforcement</h1> <div class="zoe-version">
    Zoe Alpha Release v0.11.0. Last updated
    2021-02-01.
</div> <div class="custom-block tip"><p class="custom-block-title">Alpha status</p> <p>The Agoric platform is at the alpha stage. It has not yet been formally tested
or hardened. Do not use for production purposes.</p></div> <p>This guide assumes some knowledge of the <a href="/documentation/ertp/guide/">ERTP
fundamentals</a>.</p> <h2 id="what-is-zoe"><a href="#what-is-zoe" class="header-anchor">#</a> What is Zoe?</h2> <p><strong>For users</strong>: Zoe guarantees that as a user of a smart contract, you
will either get what you wanted or get a full refund, even if the
smart contract is buggy or malicious. (In fact, the smart contract
never has access to your digital assets.)</p> <p><strong>For developers</strong>: Zoe provides a safety net so you can focus on what
your smart contract does best, without worrying about your users
losing their assets due to a bug in the code that you wrote. Writing a
smart contract on Zoe is easy: all of the Zoe smart contracts are
written in the familiar language of JavaScript.</p> <h2 id="sounds-like-magic-how-does-it-actually-work"><a href="#sounds-like-magic-how-does-it-actually-work" class="header-anchor">#</a> Sounds like magic. How does it actually work?</h2> <p>To use Zoe, we put things in terms of &quot;offers&quot;. An offer proposal is a
statement about what you want and what you're willing to offer. It
turns out, many smart contracts (apart from gifts and one-way
payments) involve an exchange of digital assets that can be put in
terms of offer proposals. We
can say things like, &quot;I'll give you <a href="https://en.wikipedia.org/wiki/Catan" target="_blank" rel="noopener noreferrer">three wood for two
bricks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.&quot; <a href="/documentation/zoe/guide/proposal.html">Learn more about the
particulars of structuring an offer proposal here</a>.</p> <p>Offers are a structured way of describing user intent. To a certain
extent, an offer's rules (called a <em>proposal</em>) are the user's
<em>contractual understanding</em> of the agreement they are entering into.</p> <p>You might have noticed that the offer doesn't specify the mechanism by
which the exchange happens. The offer doesn't say whether the item you
want is up for auction, in an exchange, or part of a private trade.
The offer doesn't mention the particular mechanism because an
important part of the design of Zoe is a <strong>separation of concerns</strong>.</p> <p>Zoe is responsible for enforcing what we call &quot;offer safety&quot;, and the
smart contract that runs on top of Zoe is responsible for figuring out
a proposed reallocation of resources. To use an auction as an example,
the smart contract is responsible for figuring out who wins the
auction and how much they pay, but Zoe handles the escrowing of the
bids and the payments. You can think of this as similar to e-commerce
websites using a separate payment-processor so that they don't have to
handle the credit cards themselves.</p> <h3 id="what-is-offer-safety"><a href="#what-is-offer-safety" class="header-anchor">#</a> What is &quot;offer safety&quot;?</h3> <p>Zoe guarantees offer safety, meaning that when a user makes an offer
and it is escrowed with Zoe, Zoe guarantees that the user either
gets back what they said they wanted, or gets back (refunded) what they
originally offered and escrowed.</p> <p>When a user escrows with Zoe, they get back
a JavaScript promise for a future payout. Let's
look a particular example to see how this works.</p> <h2 id="an-example-a-swap"><a href="#an-example-a-swap" class="header-anchor">#</a> An example: A swap</h2> <p>I want to trade my three bricks for five wool. You realize you have
five wool and agree to the deal. Without Zoe, you might send
me the five wool, and I might disappear without ever giving you the
three bricks. With Zoe, we can safely trade with each other,
even if we don't trust each other. We are assured that at worst, if
the swap contract behaves badly, we both get a refund, and at
best, we get what we each wanted.</p> <p>Let's look at the basic <code>atomicSwap</code> contract (<a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/zoe/src/contracts/atomicSwap.js" target="_blank" rel="noopener noreferrer">full text of
the real contract<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p> <p>Here's a high-level overview of what happens:</p> <ol><li>I make an instance of the swap contract, and get an invitation to
participate in the contract.</li> <li>I make an offer through Zoe by presenting my invitation, a proposal
of 3 bricks for 5 wool, and a payment with the 3 bricks. Zoe escrows
the bricks and returns me a seat (a <code>UserSeat</code> to be precise) in the
contract, from which I can get the results of my offer, the payouts, etc.</li> <li>The result of processing my offer is an invitation for my counterparty.
I send you that invitation to participate in this contract instance.</li> <li>You inspect the invitation and verify it was created by the
<code>atomicSwap</code> contract code.</li> <li>You use your invitation to make your offer (offering five wool for
three bricks) with Zoe, making a matching offer. You get your own seat
to with which to access your payout and offer results.</li> <li>The contract confirms that our offers match, and reallocates our bricks
and wool and exits our offers. That will resolve our respective payout
promises, mine to the five wool that I wanted, and yours to the three
bricks that you wanted. Success!</li></ol> <h2 id="how-to-write-smart-contracts"><a href="#how-to-write-smart-contracts" class="header-anchor">#</a> How to write smart contracts</h2> <p>Writing smart contracts that run on Zoe is easy. Let's look
at a simple contract. It only does one thing, and
it's pretty useless - it gives you back what you put in. Let's call it
<code>automaticRefund</code>. Let's say the code of <code>automaticRefund</code> looks like
this (see the <a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/zoe/src/contracts/automaticRefund.js" target="_blank" rel="noopener noreferrer">real contract code
here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>):</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token parameter">zcf</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">refund</span> <span class="token operator">=</span> <span class="token parameter">seat</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    seat<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The offer was accepted</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">makeRefundInvitation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> zcf<span class="token punctuation">.</span><span class="token function">makeInvitation</span><span class="token punctuation">(</span>refund<span class="token punctuation">,</span> <span class="token string">'getRefund'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> publicFacet <span class="token operator">=</span> <span class="token punctuation">{</span>
    makeInvitation<span class="token operator">:</span> makeRefundInvitation<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> creatorInvitation <span class="token operator">=</span> <span class="token function">makeRefundInvitation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> creatorInvitation<span class="token punctuation">,</span> publicFacet <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>(In a real contract, whenever we create a new object or array, we recursively
deep-freeze it with <code>@agoric/harden</code>. You can <a href="/documentation/guides/js-programming/ses/ses-guide.html">learn more about <code>harden</code> here</a>.)</p> <p>The <code>automaticRefund</code> contract behavior is implemented in <code>refund</code>.
It just tells Zoe to exit the offer, which gives the user their payout
through Zoe.</p> <p>A smart contract on Zoe must export a function named <code>start</code> that
takes a single parameter: <code>zcf</code>, which is the contract-internal API
for Zoe. The <code>start</code> function must return an object with any of
several optional properties:</p> <ul><li><code>creatorInvitation</code>: an invitation only available to the creator of the contract instance.</li> <li><code>creatorFacet</code>: an object with operations made accessible only to the creator.</li> <li><code>publicFacet</code>: and object with operations available to any client with access to the instance.</li></ul> <h2 id="diving-deeper"><a href="#diving-deeper" class="header-anchor">#</a> Diving Deeper</h2> <p>Let's dive back into the <code>atomicSwap</code> contract. As with <code>automaticRefund</code>, see the <a href="https://github.com/Agoric/agoric-sdk/blob/master/packages/zoe/src/contracts/atomicSwap.js" target="_blank" rel="noopener noreferrer">real contract code
here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The contract first confirms that <code>issuers</code> are setup for the <code>Asset</code> and <code>Price</code> keywords. Those are the two items that will be swapped.</p> <p>The following uses the <a href="/documentation/zoe/api/zoe-helpers.html#assertissuerkeywords-zcf-keywords"><code>assertIssuerKeywords</code> helper function</a>. It
checks properties of the running contract instance's terms. The terms were retrieved via <code>zcf.getTerms()</code>
in the <code>automaticRefund</code> contract.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token parameter">zcf</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">assertIssuerKeywords</span><span class="token punctuation">(</span>zcf<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Asset'</span><span class="token punctuation">,</span> <span class="token string">'Price'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The first handler defined below, <code>makeMatchingInvitation()</code> is for the contract instance's creator, and it
makes the <code>invitation</code> for the other party to use. At the end of this section, we'll see how it's incorporated into
the contract. When the associated <code>invitation</code> is used to make an offer, <code>makeMatchingInvitation()</code> is invoked
with the <code>seat</code> for that offer.</p> <p>This contract uses the
<a href="/documentation/zoe/api/zoe-helpers.html#assertproposalshape-seat-expected"><code>assertProposalShape</code> helper function</a> to
check that the offer proposes the kind of trade the contract accepts. In this case, offers must
have a proposal of the form:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> give<span class="token operator">:</span> <span class="token punctuation">{</span> Asset<span class="token operator">:</span> amount1 <span class="token punctuation">}</span><span class="token punctuation">,</span> want<span class="token operator">:</span> <span class="token punctuation">{</span> Price<span class="token operator">:</span> amount2 <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div><p><code>amount1</code> and <code>amount2</code> are amounts with the correct issuers for the keywords.
The contract then uses <code>getProposal()</code> to extract the properties of the proposal for later matching.</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> <span class="token function-variable function">makeMatchingInvitation</span> <span class="token operator">=</span> <span class="token parameter">firstSeat</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">assertProposalShape</span><span class="token punctuation">(</span>firstSeat<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      give<span class="token operator">:</span> <span class="token punctuation">{</span> Asset<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      want<span class="token operator">:</span> <span class="token punctuation">{</span> Price<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> want<span class="token punctuation">,</span> give <span class="token punctuation">}</span> <span class="token operator">=</span> firstSeat<span class="token punctuation">.</span><span class="token function">getProposal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>makeMatchingInvitation()</code>, our first handler, then constructs a handler for the second offer,
with the first offer's <code>want</code> and <code>give</code> in scope. This second
handler, <code>matchingSeatOfferHandler()</code> does the final step.
It uses the <a href="/documentation/zoe/api/zoe-helpers.html#swap-zcf-leftseat-rightseat-lefthasexitedmsg-righthasexitedmsg"><code>swap</code> helper  function</a>,
a powerful Zoe Helper that handles a lot of the logic of doing a basic swap of assets.</p> <p>If the swap succeeds, it reallocates the assets between the parties, as described above. The handler then exits
both seats (causing payouts to be made available to both parties) and shuts down the contract.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> <span class="token function-variable function">matchingSeatOfferHandler</span> <span class="token operator">=</span> <span class="token parameter">matchingSeat</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> swapResult <span class="token operator">=</span> <span class="token function">swap</span><span class="token punctuation">(</span>zcf<span class="token punctuation">,</span> firstSeat<span class="token punctuation">,</span> matchingSeat<span class="token punctuation">)</span><span class="token punctuation">;</span>
      zcf<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> swapResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Now let's put it together. The last step of the first handler, <code>makeMatchingInvitation()</code>
is to create and return the second party's invitation, using
<code>matchingSeatOfferHandler</code> and including custom properties for the proposal of the invited offer.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> matchingSeatInvitation <span class="token operator">=</span> zcf<span class="token punctuation">.</span><span class="token function">makeInvitation</span><span class="token punctuation">(</span>
      matchingSeatOfferHandler<span class="token punctuation">,</span>
      <span class="token string">'matchOffer'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        asset<span class="token operator">:</span> give<span class="token punctuation">.</span>Asset<span class="token punctuation">,</span>
        price<span class="token operator">:</span> want<span class="token punctuation">.</span>Price<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> matchingSeatInvitation<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Finally, we make the invitation for the first party, and return it as
the contract's <code>creatorInvitation</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> creatorInvitation <span class="token operator">=</span> zcf<span class="token punctuation">.</span><span class="token function">makeInvitation</span><span class="token punctuation">(</span>
    makeMatchingInvitation<span class="token punctuation">,</span>
    <span class="token string">'firstOffer'</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> creatorInvitation <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>creatorInvitation</code> is only available to the contract instance's creator.
(see <a href="/documentation/zoe/api/zoe.html#e-zoe-startinstance-installation-issuerkeywordrecord-terms"><code>startInstance</code></a>).
The creator can use it (by making an offer with it) or send it to some other party.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Agoric/documentation/edit/main/main/zoe/guide/README.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/22/2021, 2:45:43 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/documentation/getting-started/intro-zoe.html" class="prev">
        Zoe Introduction
      </a></span> <span class="next"><a href="/documentation/zoe/guide/offer-safety.html">
        Offer Safety
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/documentation/assets/js/app.e9d39649.js" defer></script><script src="/documentation/assets/js/2.055035d6.js" defer></script><script src="/documentation/assets/js/68.b16ef159.js" defer></script><script src="/documentation/assets/js/20.87ef6363.js" defer></script>
  </body>
</html>
