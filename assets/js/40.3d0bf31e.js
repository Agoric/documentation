(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{392:function(t,e,a){"use strict";a.r(e);var n=a(42),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"introduction-to-zoe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#introduction-to-zoe"}},[t._v("#")]),t._v(" Introduction to Zoe")]),t._v(" "),a("p",[a("strong",[t._v("Note:")]),t._v(" Before reading this, you should be familiar with "),a("RouterLink",{attrs:{to:"/getting-started/ertp-introduction/"}},[t._v("ERTP basics")]),t._v(".")],1),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Pre-alpha status")]),t._v(" "),a("p",[t._v("Zoe is currently at the pre-alpha stage. It has not yet been\nformally tested or hardened. It is not yet of production quality.")])]),t._v(" "),a("p",[t._v("This is an introduction to Zoe, Agoric's smart contract framework. The "),a("RouterLink",{attrs:{to:"/zoe/guide/"}},[t._v("Zoe Guide")]),t._v(" has more complete and detailed information, including concepts not covered here.")],1),t._v(" "),a("p",[t._v("You can run different types of smart contracts on Zoe. In this document, for the most part we focus on Agoric’s Atomic Swap demo contract, but sometimes refer to how Zoe works with other contract types.")]),t._v(" "),a("h2",{attrs:{id:"what-is-zoe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-zoe"}},[t._v("#")]),t._v(" What is Zoe?")]),t._v(" "),a("p",[a("strong",[t._v("For users")]),t._v(": Zoe guarantees as a user of a smart contract, you either get what you wanted or get a full refund, even if the smart contract is buggy or malicious.")]),t._v(" "),a("p",[a("strong",[t._v("For developers")]),t._v(": Zoe is a framework for writing and running smart contracts. It provides a safety net so you can focus on what your smart contract does best, without worrying about users losing their assets due to a bug in your code.")]),t._v(" "),a("p",[t._v("Many contracts are installed on Zoe, including "),a("a",{attrs:{href:"https://agoric.com/documentation/zoe/guide/contracts/",target:"_blank",rel:"noopener noreferrer"}},[t._v("several Agoric-written ones"),a("OutboundLink")],1),t._v(" to get you started.")]),t._v(" "),a("h2",{attrs:{id:"the-simple-atomic-swap-contract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-simple-atomic-swap-contract"}},[t._v("#")]),t._v(" The simple Atomic Swap contract")]),t._v(" "),a("p",[t._v("In this document, we’ll mostly be looking at Agoric’s "),a("a",{attrs:{href:"https://agoric.com/documentation/zoe/guide/contracts/atomic-swap.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Atomic Swap contract"),a("OutboundLink")],1),t._v(" to illustrate how contracts use Zoe.")]),t._v(" "),a("p",[t._v("Atomic Swap has two users swapping for each other’s assets. We’ll try to let you know when aspects of the contract are specific to a basic swap operation. Other types of contracts, such as auctions, may do things differently. The annotated code for our example is "),a("a",{attrs:{href:"https://agoric.com/documentation/zoe/guide/contracts/atomic-swap.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(". The source code is "),a("a",{attrs:{href:"https://github.com/Agoric/agoric-sdk/blob/master/packages/zoe/src/contracts/atomicSwap.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(", with helpers defined "),a("a",{attrs:{href:"https://github.com/Agoric/agoric-sdk/blob/master/packages/zoe/src/contractSupport/zoeHelpers.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(". Tests are "),a("a",{attrs:{href:"https://github.com/Agoric/agoric-sdk/blob/47b3729aa6b4ebde0d23cf791c5295fcf8f58a00/packages/zoe/test/unitTests/contracts/test-atomicSwap.js#L14",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(". The tests have two “characters”, Alice, who makes the initial offer, and Bob, who responds to that offer.")]),t._v(" "),a("h2",{attrs:{id:"installing-and-instantiating-contracts-on-zoe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installing-and-instantiating-contracts-on-zoe"}},[t._v("#")]),t._v(" Installing and instantiating contracts on Zoe")]),t._v(" "),a("p",[t._v("To use a contract, it needs to be "),a("em",[t._v("installed")]),t._v(" on Zoe. This is putting the contract’s source code, consisting of JavaScript plus ERTP and Zoe API requests, on Zoe.")]),t._v(" "),a("p",[t._v("When a contract is installed on Zoe, the operation returns an "),a("code",[t._v("installationHandle")]),t._v(", which is an "),a("em",[t._v("opaque JavaScript object")]),t._v("  used to refer to the installed contract source code. Agoric uses such objects as handles since they cannot be forged. For example")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" installationHandle "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zoe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" moduleFormat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("A contract has to be "),a("em",[t._v("instantiated")]),t._v(" for it to actually be used. A contract can be instantiated by calling "),a("code",[t._v("E(zoe).makeInstance(installationHandle).")]),t._v(" Multiple "),a("em",[t._v("instances")]),t._v(" of any Zoe-installed contract can execute simultaneously. For clarity, in this document a "),a("em",[t._v("contract")]),t._v(" is the installed code that defines how the contract works. A "),a("em",[t._v("contract instance")]),t._v(" is an active execution of the contract code.")]),t._v(" "),a("p",[t._v("For example, let’s say a realtor has a standard agreement they use when selling a client’s house. The contract would be the code that defines how that standard agreement works. Every time the realtor has a new house to sell, they instantiate a new instance of their standard contract to use for that specific property. If they have ten houses up for sale, they have ten different contract instances.")]),t._v(" "),a("p",[t._v("In addition to an "),a("code",[t._v("installationHandle")]),t._v(", when the contract is instantiated, Zoe needs to know what kind of ERTP assets the contract will work with. In Atomic Swap’s test code, the full instantiation call is:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" issuerKeywordRecord "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("harden")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Asset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" moolaIssuer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  Price"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" simoleanIssuer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" aliceInvite "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zoe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  installationHandle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  issuerKeywordRecord"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("Let’s work backwards from "),a("code",[t._v("makeInstance()")]),t._v("’s arguments. As you’ll recall from the "),a("a",{attrs:{href:"https://agoric.com/documentation/getting-started/ertp-introduction.html#issuers-and-mints",target:"_blank",rel:"noopener noreferrer"}},[t._v("Introduction to ERTP"),a("OutboundLink")],1),t._v(", "),a("em",[t._v("issuers")]),t._v(" map minted assets to purses and payments. The "),a("em",[t._v("keyword record")]),t._v(" is made up of two key:value pairs. The key names must be ASCII and capitalized; they are the same as are used in the contract code, in this case "),a("code",[t._v("Price")]),t._v(" and "),a("code",[t._v("Asset")]),t._v(". "),a("code",[t._v("Price")]),t._v(" is for what is wanted, and "),a("code",[t._v("Asset")]),t._v(" is for what is being sold. "),a("code",[t._v("Price")]),t._v(" is for what will be swapped for it (from the perspective of the user making the instance; it’d be the opposite for someone who wanted what Alice is offering). The price is denominated in the imaginary currency simoleons, so that keyword needs the simoleon Issuer associated with it. The asset is denominated in the imaginary currency moola, so that keyword needs the moola Issuer as its value.")]),t._v(" "),a("p",[t._v("Finally, "),a("code",[t._v("E(zoe).makeInstance()")]),t._v(" can take a "),a("code",[t._v("terms")]),t._v(" argument, another set of key:value pairs. Terms let a contract instance creator further customize the contract operations, as enabled by the contract code. Contract terms can be expressed without specific values. For example, an auction contract may define minimum bid and minimum raise variables and use them in its code, but the variables are not given values in the code. Instead, the "),a("code",[t._v("terms")]),t._v(" argument provides the variables’ values.")]),t._v(" "),a("p",[t._v("Why the need to parameterize a contract with terms? Well, the minimum raise should be quite different if an auction is for a used Harry Potter paperback vs. a signed first British hardback edition of "),a("em",[t._v("Harry Potter and the Philosopher’s Stone")]),t._v(". The "),a("code",[t._v("terms")]),t._v(" value for the used paperback auction would be "),a("code",[t._v("{ Currency: 'USDollar', MinRaise: 1 }")]),t._v(". For the first edition auction, "),a("code",[t._v("terms")]),t._v("’ value would be  "),a("code",[t._v("{ Currency: 'USDollar', MinRaise: 500 }")]),t._v(". With the different "),a("code",[t._v("terms")]),t._v(" values, there are now contract instances customized for the items being sold in each one.")]),t._v(" "),a("h2",{attrs:{id:"invites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#invites"}},[t._v("#")]),t._v(" Invites")]),t._v(" "),a("p",[t._v("The "),a("code",[t._v("E(zoe).makeInstance()")]),t._v(" call returns an "),a("em",[t._v("invite")]),t._v(" to that contract instance. Invites are "),a("a",{attrs:{href:"https://agoric.com/documentation/getting-started/ertp-introduction.html#creating-assets-with-ertp",target:"_blank",rel:"noopener noreferrer"}},[a("em",[t._v("ERTP payment objects")]),a("OutboundLink")],1),t._v(" that let their holder interact with that specific contract instance. If there are ten instances of a contract running and you hold an invite to, say, the earliest created one, that’s the only one the invite works with. It doesn’t work with any of the nine later created contract instances.")]),t._v(" "),a("p",[t._v("And while whoever instantiated the contract gets the initial invite to that instantiation, as with all invites, they can transfer it to another party before it’s used. Who created or first held an invite doesn’t matter. Whoever possesses an invite has control and use of it.")]),t._v(" "),a("p",[t._v("Users obtain invites to a contract instance in one (or more) of three ways:")]),t._v(" "),a("ul",[a("li",[t._v("Instantiate a contract, which returns an invite object for that contract instance.")]),t._v(" "),a("li",[t._v("By receiving an invite from someone who already had it.\n"),a("ul",[a("li",[t._v("Note: Finding other parties to invite is out of Zoe or the contract’s scope in most cases. You have to either already know of potential other parties, for example, from past experience trading with them, or communicate somewhere outside the contract to find them.")])])]),t._v(" "),a("li",[t._v("By the contract instance or someone with the authority to issue invites for this contract instantiation making open knowledge what’s needed to get a valid invite. For example, an open exchange contract with an order book might welcome everyone who wants to participate, and so would make public how to get an invite to it.")])]),t._v(" "),a("p",[a("em",[t._v("Invites")]),t._v(" are ERTP "),a("em",[t._v("payments")]),t._v(", so the same principles apply to them as apply to other ERTP payments. You can send the same payment or invite to multiple parties...but when a party claims the payment, that payment is dead. The claimant gets a new payment they know was issued by the desired issuer, and which they have exclusive access to.")]),t._v(" "),a("p",[t._v("Invites are single use objects. So once used, an invite is destroyed or "),a("em",[t._v("burned")]),t._v(". If someone shared a valid invite with many people, only the first one to be used would work; any attempts to use that invite after it’s been used fail. Note that this is different from making multiple distinct invites for a contract instance; that’s expected.")]),t._v(" "),a("h2",{attrs:{id:"offers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#offers"}},[t._v("#")]),t._v(" Offers")]),t._v(" "),a("p",[t._v("Alice decides she wants to use her invite and make an "),a("em",[t._v("offer")]),t._v(". Before making an offer, an invite is all about "),a("em",[t._v("potentially")]),t._v(" working with its associated contract instance. But the invite might never be used, and if so, it never actually interacts with the contract instance.")]),t._v(" "),a("p",[t._v("Before making her offer, Alice has to do some prep work. Her offer will be "),a("em",[t._v("escrowed")]),t._v(" with Zoe, so it needs to include the actual ERTP payments for the offer, and a "),a("em",[t._v("proposal")]),t._v(" that defines the offer and is used to enforce both "),a("em",[t._v("offer safety")]),t._v(" and "),a("em",[t._v("payout liveness")]),t._v(".  In code, it looks like:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" moola "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" moolaAmountMath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("make"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" simoleans "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" simoleanAmountMath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("make"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" aliceProposal "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("harden")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  give"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Asset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("moola")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  want"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Price"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("simoleans")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  exit"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" onDemand"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nConst alicePayments "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Asset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" aliceMoolaPayment "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("AmountMath")]),t._v(" is an "),a("a",{attrs:{href:"https://agoric.com/documentation/ertp/guide/amount-math.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ERTP API object "),a("OutboundLink")],1),t._v(" whose methods manipulate asset and payment amounts. Here, Alice is setting up the ability to use the moola and simolean currencies.")]),t._v(" "),a("p",[t._v("She then creates her proposal, using an object with "),a("code",[t._v("give")]),t._v(", "),a("code",[t._v("want")]),t._v(", and "),a("code",[t._v("exit")]),t._v(" (optional) properties. "),a("code",[t._v("give")]),t._v(" and "),a("code",[t._v("want")]),t._v(" are objects with keywords as keys and amounts as values. "),a("code",[t._v("exit")]),t._v(" is an "),a("code",[t._v("ExitRule")]),t._v(" record. In the above example, Alice wants at least 15 simoleans, in exchange for giving at most 3 moola, where she can exit the offer at any time just by asking, and get her money back (or get her "),a("code",[t._v("want")]),t._v(" if the offer happened to be satisfied before then).")]),t._v(" "),a("p",[t._v("The "),a("code",[t._v("want")]),t._v(" and "),a("code",[t._v("give")]),t._v("values are JavaScript records, objects with property names and values. The property names of these records are the keywords in the "),a("code",[t._v("keywordRecord")]),t._v(" from when you created the contract instance. The values of the records are "),a("a",{attrs:{href:"https://agoric.com/documentation/ertp/guide/amounts.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ERTP amounts"),a("OutboundLink")],1),t._v(" of how many of the asset the user either wants or is willing to give in exchange.")]),t._v(" "),a("p",[t._v("The "),a("code",[t._v("harden()")]),t._v(" command is how to build a defensible API surface around an object by freezing all reachable properties. It’s similar, but not identical, to JavaScript’s "),a("code",[t._v("Object.freeze")]),t._v(". For more information on "),a("code",[t._v("harden")]),t._v(", see "),a("a",{attrs:{href:"https://www.npmjs.com/package/@agoric/harden#background-why-do-we-need-to-harden-objects",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Now, Alice is ready to use her invite, proposal, and payment to make an offer and participate in the Atomic Swap instance.")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" outcome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" alicePayoutP "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zoe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("offer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  aliceInvite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  aliceProposal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  alicePayments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("Zoe checks the invite for its validity for that contract instance. If it’s an invalid invite, the offer attempt fails, and Alice gets her refund in the payout. When she makes her offer, Alice receives an "),a("em",[t._v("outcome")]),t._v(" and a "),a("em",[t._v("promise")]),t._v(" that resolves to her "),a("em",[t._v("payout")]),t._v(". If the offer is valid, it's now an "),a("em",[t._v("active offer")]),t._v(".")]),t._v(" "),a("p",[t._v("Now, Alice needs to get someone else involved who potentially will also make an offer, hopefully one that offers what she wants for the price she’s willing to pay for it. For the Atomic Swap contract, the "),a("em",[t._v("outcome")]),t._v(" from her offer resolves to an "),a("em",[t._v("invite")]),t._v(" she can send to others, in this case Bob. This is specific to this Atomic Swap contract; the outcome is whatever the contract instance returns from its hook that was attached to the invite when it was created:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newInviteP "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" outcome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" inviteIssuer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zoe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInviteIssuer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" bobExclusiveInvite "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" inviteIssuer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("claim")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newInviteP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" instanceHandle "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInstanceHandle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bobExclusiveInvite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  installationHandle"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" bobInstallationId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  issuerKeywordRecord"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" bobIssuers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zoe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("instanceHandle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("Bob decides to make his own offer, which happens to match up with Alice’s offer (assume his payments were constructed similar to Alice’s);")]),t._v(" "),a("div",{staticClass:"language-const bobProposal = harden({ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  want: { Asset: moola(3) },\n  give: { Price: simoleans(7) },\n  exit: { onDemand: null },\n})\n\n\n// Bob escrows with zoe and makes an offer\nconst { outcome: bobOfferResult, payout: bobPayoutP } = await E(zoe).offer(\n  bobExclusiveInvite,\n  bobProposal,\n  bobPayments,\n);\n")])])]),a("p",[t._v("Bob has also gotten back an "),a("em",[t._v("outcome")]),t._v(" and a "),a("em",[t._v("promise")]),t._v(" for a "),a("em",[t._v("payout")]),t._v(". His offer is also now an "),a("em",[t._v("active offer")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"satisfying-and-completing-offers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#satisfying-and-completing-offers"}},[t._v("#")]),t._v(" Satisfying and completing offers")]),t._v(" "),a("p",[t._v("At this point, both the offers that Alice and Bob made are active and known to the contract instance. The Atomic Swap contract code determines that they are matching offers.  The contract instance calls "),a("code",[t._v("reallocate")]),t._v(", which "),a("em",[t._v("reallocates")]),t._v(" the amounts which are the accounting records within Zoe. Payouts are not created here.")]),t._v(" "),a("p",[t._v("The contract instance then "),a("em",[t._v("completes")]),t._v(" the offers. A call to "),a("code",[t._v("zcf.complete()")]),t._v(" with both offers as arguments, makes the payouts to the offer holders.  This takes the amounts from the account records, and withdraws the amounts specified by the offers from the digital assets escrowed within Zoe. It's only at the "),a("code",[t._v("complete")]),t._v(" step that "),a("em",[t._v("amounts")]),t._v(" are turned into real payments. This is when the payout "),a("em",[t._v("promise")]),t._v(" resolves into payments.")]),t._v(" "),a("p",[t._v("The offers are now completed and no longer active. There is nothing more that can be done with them, so Zoe deletes completed offers from the contract instance.")]),t._v(" "),a("h2",{attrs:{id:"auction-example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#auction-example"}},[t._v("#")]),t._v(" Auction example")]),t._v(" "),a("p",[t._v("Let’s look at a more complicated example: an auction, where many users might make a bid offer for something, but only one offer will win the auction. Assuming everything validated, Zoe would give the holder of the auctioned item the escrowed amount from the winning offer, and give the holder of the winning offer what they wanted, the item that had been up for bid.")]),t._v(" "),a("p",[t._v("But what about all those other bidders who escrowed their bid amounts with Zoe and didn’t win? Zoe guarantees they all get a "),a("em",[t._v("refund")]),t._v(" of their escrowed amount. Zoe’s "),a("em",[t._v("offer safety")]),t._v(" guarantees offer makers either get what they wanted or get refunded whatever they put in Zoe’s escrow with their offer.")]),t._v(" "),a("p",[t._v("It’s even possible to get both what you wanted in an offer, and at least a partial refund of what you offered. Consider an auction where you make a bid offer where you’re willing to pay up to 10 quatloos (an imaginary currency), but if you can win with a lower bid, that’s your offer. You win the auction, but your winning bid amount is only 8 quatloos. The payout would resolve to both the item up for auction you get as the winning bidder and the refund of the 2 extra quatloos you escrowed in the offer.")]),t._v(" "),a("h2",{attrs:{id:"other-things-to-know-about-zoe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#other-things-to-know-about-zoe"}},[t._v("#")]),t._v(" Other things to know about Zoe")]),t._v(" "),a("p",[t._v("A "),a("em",[t._v("Dapp (decentralized application)")]),t._v(" is a combination of a Zoe contract and a server that’s running the back and front ends, and a front end that may be connected to the user’s wallet.")]),t._v(" "),a("p",[t._v("Zoe has two distinct APIs. One is the widely accessible, singular Zoe service object that smart contract clients use to provide offers and otherwise interface with contracts. The Zoe service object is a remote object, and so should be accessed with "),a("code",[t._v("E(zoe).<api_method>")]),t._v(", which returns a promise. For more on E() see "),a("a",{attrs:{href:"https://agoric.com/documentation/distributed-programming.html#communicating-with-remote-objects-via-e",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("The other is the internal API object, referred to as "),a("code",[t._v("zcf")]),t._v(" that each contract instance uses to interact with Zoe about that contract’s own offers and state (e.g., to do "),a("code",[t._v("reallocate")]),t._v(" and "),a("code",[t._v("complete")]),t._v(").")]),t._v(" "),a("h2",{attrs:{id:"workflow-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#workflow-summary"}},[t._v("#")]),t._v(" Workflow summary")]),t._v(" "),a("p",[t._v("The following table summarizes an Atomic Swap workflow:")]),t._v(" "),a("table",[a("tbody",[a("tr",[a("td",[a("center",[t._v("1")])],1),t._v(" "),a("td",[t._v("Write your contract\n")])]),t._v(" "),a("tr",[a("td",[a("center",[t._v("2")])],1),t._v(" "),a("td",[t._v("Install your contract’s source code on Zoe. \n")])]),t._v(" "),a("tr",[a("td",[a("center",[t._v("3")])],1),t._v(" "),a("td",[t._v("Start a contract instance based on an installed contract. \n")])]),t._v(" "),a("tr",[a("td",{attrs:{colspan:"2"}},[t._v("At this point, everything is installed and set up and you’ve got a contract instance. The following rows cover what happens to offers in a contract instance.\n")])]),a("tr"),a("tr",[a("td",[a("center",[t._v("1")])],1),t._v(" "),a("td",[t._v("A holder of an invite to this contract instance uses it to make an offer. The assets used in the offer are escrowed with Zoe.\n")])]),t._v(" "),a("tr",[a("td",[a("center",[t._v("2")])],1),t._v(" "),a("td",[t._v("Likely via means outside of the contract, invites are distributed to potential users of this contract instance).")])]),t._v(" "),a("tr",[a("td",[a("center",[t._v("3")])],1),t._v(" "),a("td",[t._v("Invite receivers validate the invite.\n")])]),t._v(" "),a("tr",[a("td",[a("center",[t._v("4")])],1),t._v(" "),a("td",[t._v("Invite holders make their offers.\n")])]),t._v(" "),a("tr",[a("td",[a("center",[t._v("5")])],1),t._v(" "),a("td",[t._v("The contract instance hooks trigger, driving the contract behavior, which may request some reallocations as a result.")])]),t._v(" "),a("tr",[a("td",[a("center",[t._v("6")])],1),t._v(" "),a("td",[t._v("Zoe reallocates the assets among the offers, preserving offer safety.\n")])]),t._v(" "),a("tr",[a("td",[a("center",[t._v("7")])],1),t._v(" "),a("td",[t._v("The contract requests Zoe  complete the satisfied offers, resolving their associated payout promises. Offer holders either get what they paid for, get their escrowed offer amount refunded, or in some cases, get both what they paid for and a refund of any overpayment.\n")])])])]),t._v(" "),a("h2",{attrs:{id:"next-steps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#next-steps"}},[t._v("#")]),t._v(" Next steps")]),t._v(" "),a("p",[t._v("If you want to dive deeper into how Zoe works and what you can do, go to the "),a("a",{attrs:{href:"https://agoric.com/documentation/zoe/guide/#what-is-zoe",target:"_blank",rel:"noopener noreferrer"}},[t._v("Zoe Guide"),a("OutboundLink")],1),t._v(".")])])}),[],!1,null,null,null);e.default=s.exports}}]);